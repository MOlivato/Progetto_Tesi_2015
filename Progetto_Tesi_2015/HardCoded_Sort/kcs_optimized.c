#include <stdio.h>
#include <string.h>

//Funzione che stampa un vettore
void printv(int v[], int n){
	int i;
	
	for(i=0;i<n;i++)
		printf(" %i", v[i]);
	
	printf("\n");
}
/*
//Funzione che recupera la chiave della combinazione e il ciclo
// da effettuare per ordinarla
int getkey(int chiavi[120][11], int v[], int numchiavi, int lvett){

	int btf;
	int i,j;
	int k=0,l=0;
	
	for(i=1;i<lvett;i++){
		for(j=0;j<lvett-i;j++){
			
			//Trovo il bit della chiave da cercare
			btf = v[j]<=v[j+i]?1:0;
			
			//Scorro la matrice ordinata per allinearmi con il mio bit
			while(k<numchiavi && chiavi[k][l] != btf){
				k++;
			}
			l++;
			
			//Se ho trovato la chiave ritorno
			if(chiavi[k][l] == -1) return k;
		}
	}
	

	return -1;
}*/

//Funzione che recupera la chiave della combinazione e il ciclo
// da effettuare per ordinarla
int getkey(int chiavi[291][2], int v[], int numchiavi, int lvett){

	int btf;
	int i,j;
	int chiave=0;
	
	for(i=1;i<lvett;i++){
		for(j=0;j<lvett-i;j++){
			
			//Trovo il bit della chiave da cercare
			btf = v[j]<=v[j+i]?1:0;
			printf("btf: %i\n",btf);
			
			//Recupero il puntatore interno al vettore al prossimo bit
			chiave = chiavi[chiave][btf];
			printf("chiave: %i\n",chiave);
			
			//Se il puntatore punta ad un valore negativo allora lo ritorno
			if(chiavi[chiave][0] < 0) return (chiavi[chiave][0] * -1)-1;
		}
	}
	

	return -1;
}

//Ordino la combinazione usando i cicli
void sortkc(int v[], int lvett, int cicli[120][8], int chiave){
	int i, startpos, temp, val;
		
	if(cicli[chiave][0]==-1) return;
	
	startpos = cicli[chiave][0];
	val = v[startpos];
	
	for(i=1;cicli[chiave][i]!=-1;i++){
		
		//Se sto ricominciando un ciclo
		if(startpos ==-1){
			startpos=cicli[chiave][i];
			val = v[startpos];
		}
		
		//Se sono dentro un ciclo normale
		if(startpos != cicli[chiave][i]){
			temp=v[cicli[chiave][i]];
			v[cicli[chiave][i]]=val;
			val=temp;
			startpos=cicli[chiave][i];
		}else{
			//Ho finito il ciclo
			v[cicli[chiave][i]]=val;
			startpos=-1;
		}
	}

}

void main() {
	
	//Chiavi per le combinazioni lunghe 5
	int chiavi[291][2] = {
	{1,146}
	,{2,50},{3,15},{4,5},{-1,-1},{6,0},{7,0},{8,9},{-2,-2},{10,0},{11,12}
	,{-3,-3},{13,14},{-4,-4},{-5,-5},{16,34},{17,0},{18,21},{19,20},{-6,-6},{-7,-7}
	,{22,25},{23,24},{-8,-8},{-9,-9},{26,29},{27,28},{-10,-10},{-11,-11},{30,31},{-12,-12}
	,{32,33},{-13,-13},{-14,-14},{35,0},{36,43},{0,37},{38,0},{39,40},{-15,-15},{41,42}
	,{-16,-16},{-17,-17},{0,44},{45,49},{0,46},{47,48},{-18,-18},{-19,-19},{-20,-20},{51,110}
	,{52,72},{53,60},{54,55},{-21,-21},{56,0},{57,0},{58,59},{-22,-22},{-23,-23},{61,62}
	,{-24,-24},{63,0},{64,67},{65,66},{-25,-25},{-26,-26},{68,69},{-27,-27},{70,71},{-28,-28}
	,{-29,-29},{73,91},{74,84},{75,79},{76,0},{77,78},{-30,-30},{-31,-31},{80,0},{0,81}
	,{82,83},{-32,-32},{-33,-33},{85,86},{-34,-34},{87,0},{0,88},{89,90},{-35,-35},{-36,-36}
	,{92,100},{93,99},{94,0},{95,96},{-37,-37},{97,98},{-38,-38},{-39,-39},{-40,-40},{101,107}
	,{102,106},{0,103},{104,105},{-41,-41},{-42,-42},{-43,-43},{108,109},{-44,-44},{-45,-45},{111,136}
	,{112,127},{0,113},{114,121},{115,118},{116,117},{-46,-46},{-47,-47},{119,120},{-48,-48},{-49,-49}
	,{122,123},{-50,-50},{0,124},{125,126},{-51,-51},{-52,-52},{0,128},{129,135},{0,130},{131,132}
	,{-53,-53},{133,134},{-54,-54},{-55,-55},{-56,-56},{137,145},{0,138},{0,139},{140,144},{0,141}
	,{142,143},{-57,-57},{-58,-58},{-59,-59},{-60,-60},{147,243},{148,184},{149,159},{150,151},{-61,-61}
	,{152,0},{153,0},{154,155},{-62,-62},{156,0},{157,158},{-63,-63},{-64,-64},{160,169},{161,0}
	,{162,163},{-65,-65},{164,0},{165,168},{166,167},{-66,-66},{-67,-67},{-68,-68},{170,0},{171,177}
	,{172,176},{173,0},{174,175},{-69,-69},{-70,-70},{-71,-71},{178,181},{179,180},{-72,-72},{-73,-73}
	,{182,183},{-74,-74},{-75,-75},{185,223},{186,205},{187,197},{188,191},{189,190},{-76,-76},{-77,-77}
	,{192,193},{-78,-78},{194,0},{195,196},{-79,-79},{-80,-80},{198,199},{-81,-81},{0,200},{201,204}
	,{202,203},{-82,-82},{-83,-83},{-84,-84},{206,213},{207,212},{0,208},{209,0},{210,211},{-85,-85}
	,{-86,-86},{-87,-87},{214,219},{0,215},{216,0},{217,218},{-88,-88},{-89,-89},{0,220},{221,222}
	,{-90,-90},{-91,-91},{224,236},{225,235},{0,226},{227,232},{228,231},{229,230},{-92,-92},{-93,-93}
	,{-94,-94},{233,234},{-95,-95},{-96,-96},{-97,-97},{237,242},{0,238},{0,239},{240,241},{-98,-98}
	,{-99,-99},{-100,-100},{244,279},{245,261},{0,246},{247,254},{248,0},{249,250},{-101,-101},{251,0}
	,{252,253},{-102,-102},{-103,-103},{255,0},{0,256},{257,260},{258,259},{-104,-104},{-105,-105},{-106,-106}
	,{0,262},{263,276},{264,273},{265,270},{266,269},{267,268},{-107,-107},{-108,-108},{-109,-109},{271,272}
	,{-110,-110},{-111,-111},{274,275},{-112,-112},{-113,-113},{277,278},{-114,-114},{-115,-115},{280,290},{0,281}
	,{0,282},{283,289},{0,284},{285,288},{286,287},{-116,-116},{-117,-117},{-118,-118},{-119,-119},{-120,-120}};
	
	//Cicli per le combinazioni lunghe 5
	int cicli[120][8] = 
	{{0,4,0,1,3,1,-1},
	 {0,4,1,3,0,-1},
	 {0,4,2,1,3,0,-1},
	 {0,4,3,0,1,2,1,-1},
	 {0,3,0,1,2,1,-1},
	 {0,4,0,1,3,2,1,-1},
	 {0,4,1,3,2,0,-1},
	 {0,4,0,1,2,1,-1},
	 {0,3,4,0,1,2,1,-1},
	 {0,4,1,2,0,-1},
	 {0,4,2,0,-1},
	 {0,3,4,1,2,0,-1},
	 {0,3,4,2,0,-1},
	 {0,2,0,3,4,3,-1},
	 {0,4,2,0,1,3,1,-1},
	 {0,4,3,1,2,0,-1},
	 {0,3,1,2,0,-1},
	 {0,4,3,2,0,-1},
	 {0,3,2,0,-1},
	 {0,2,0,-1},
	 {0,4,0,1,2,3,1,-1},
	 {0,4,0,2,3,2,-1},
	 {0,4,1,0,2,3,2,-1},
	 {0,3,1,2,4,0,-1},
	 {0,3,2,4,0,-1},
	 {0,3,2,4,1,0,-1},
	 {0,2,4,0,-1},
	 {0,2,4,1,0,-1},
	 {0,1,0,2,4,2,-1},
	 {0,4,1,2,3,0,-1},
	 {0,4,2,3,0,-1},
	 {0,4,3,0,-1},
	 {0,3,0,-1},
	 {0,4,2,3,1,0,-1},
	 {0,4,3,1,0,-1},
	 {0,3,1,0,-1},
	 {0,3,0,1,2,4,1,-1},
	 {0,3,0,2,4,2,-1},
	 {0,2,4,3,0,-1},
	 {0,2,3,0,-1},
	 {0,3,1,0,2,4,2,-1},
	 {0,2,4,3,1,0,-1},
	 {0,1,0,2,4,3,2,-1},
	 {0,2,3,1,0,-1},
	 {0,1,0,2,3,2,-1},
	 {0,4,0,-1},
	 {0,4,1,0,-1},
	 {0,3,4,0,-1},
	 {0,3,4,1,0,-1},
	 {0,4,2,1,0,-1},
	 {0,3,4,2,1,0,-1},
	 {0,2,1,0,3,4,3,-1},
	 {0,2,3,4,0,-1},
	 {0,2,3,4,1,0,-1},
	 {0,1,0,2,3,4,2,-1},
	 {0,1,0,3,4,3,-1},
	 {0,4,3,2,1,0,-1},
	 {0,3,2,1,0,-1},
	 {0,2,1,0,-1},
	 {0,1,0,-1},
	 {0,3,1,4,0,-1},
	 {0,2,3,1,4,0,-1},
	 {0,1,4,0,2,3,2,-1},
	 {1,4,1,2,3,2,-1},
	 {0,3,0,1,4,1,-1},
	 {0,3,0,1,4,2,1,-1},
	 {0,2,1,4,3,0,-1},
	 {0,2,1,3,0,-1},
	 {0,2,3,0,1,4,1,-1},
	 {0,1,4,2,3,0,-1},
	 {1,4,2,3,1,-1},
	 {0,1,4,3,0,-1},
	 {0,1,3,0,-1},
	 {1,4,3,1,-1},
	 {1,3,1,-1},
	 {0,3,2,1,4,0,-1},
	 {0,2,1,4,0,-1},
	 {0,3,2,0,1,4,1,-1},
	 {0,2,0,1,4,1,-1},
	 {0,1,4,2,0,-1},
	 {0,2,1,3,4,0,-1},
	 {0,2,0,1,3,4,1,-1},
	 {0,1,3,4,2,0,-1},
	 {0,1,2,0,3,4,3,-1},
	 {0,1,4,0,-1},
	 {1,4,1,-1},
	 {1,4,2,1,-1},
	 {0,1,3,4,0,-1},
	 {1,3,4,1,-1},
	 {1,3,4,2,1,-1},
	 {1,2,1,3,4,3,-1},
	 {0,3,1,4,2,0,-1},
	 {0,2,0,1,4,3,1,-1},
	 {0,2,0,1,3,1,-1},
	 {0,1,4,3,2,0,-1},
	 {0,1,3,2,0,-1},
	 {0,1,2,0,-1},
	 {1,4,3,2,1,-1},
	 {1,3,2,1,-1},
	 {1,2,1,-1},
	 {0,2,4,0,1,3,1,-1},
	 {0,1,3,2,4,0,-1},
	 {1,3,2,4,1,-1},
	 {0,1,2,4,0,-1},
	 {1,2,4,1,-1},
	 {2,4,2,-1},
	 {0,2,4,1,3,0,-1},
	 {0,1,3,0,2,4,2,-1},
	 {0,1,2,4,3,0,-1},
	 {1,3,1,2,4,2,-1},
	 {1,2,4,3,1,-1},
	 {0,1,2,3,0,-1},
	 {1,2,3,1,-1},
	 {2,4,3,2,-1},
	 {2,3,2,-1},
	 {0,1,2,3,4,0,-1},
	 {1,2,3,4,1,-1},
	 {2,3,4,2,-1},
	 {3,4,3,-1},
	 {-1} };
	
	
	//Vettore da ordinare
	int v[] = {3,3,3,3,2};
	
	printv(v,5);
	
	int chiave = getkey(chiavi,v,120,5);
	printf("Ho chiamato il getkey e ha restituito: %i\n", chiave);
	sortkc(v,5,cicli,chiave);
	printf("Ho chiamato la sortkc... \n");
	
	printv(v,5);
}
